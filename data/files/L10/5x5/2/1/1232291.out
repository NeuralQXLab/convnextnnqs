Job running on nodes: jean-zay-iam48
Resolved 60 packages in 4ms
Configuring sharding...
Number of distributed processes = 1
Number of total devices: 8
0/1 : global [CudaDevice(id=0), CudaDevice(id=1), CudaDevice(id=2), CudaDevice(id=3), CudaDevice(id=4), CudaDevice(id=5), CudaDevice(id=6), CudaDevice(id=7)]
0/1 : local [CudaDevice(id=0), CudaDevice(id=1), CudaDevice(id=2), CudaDevice(id=3), CudaDevice(id=4), CudaDevice(id=5), CudaDevice(id=6), CudaDevice(id=7)]
0/1 : hostname:  jean-zay-iam48
args_setup: Namespace(config='/lustre/fswork/projects/rech/rgs/uvm91ap/projects/deepNQS/ConvNext/04_12_24/L10_4,5x5/1/config.yaml', system='Shastry_Sutherland', network='ConvNext')
args: Namespace(config=None, system=None, network=None, L=10, J=[0.8, 1.0], n_blocks=[4], features=[72], expansion_factor=2, net_type='Vanilla', kernel_width=5, downsample_factor=2, init_kernel_width=1, samples_per_rank=512, n_chains_per_rank=512, discard_fraction=0.0, iters=[2500, 2500, 2500, 2500], lr=[0.01, 0.01, 0.01, 0.01], diag_shift=[0.05, 0.05, 0.05, 0.05], diag_shift_factor=[0.0001, 0.0001, 0.0001, 0.0001], r=1e-06, save_base='', save_num=0, seed=20, time_it=0, show_progress=1, chunk_size=512, lr_factor=[0.5, 0.5, 0.5, 0.5], save_every=100, symmetries=0, symmetry_ramping=1, momentum=0.9, checkpoint=1, post_iters=50, sweep_factor=1, double_precision=1)
Double precision enabled =  True
Using net_type=Vanilla
Number of symmetry stages = 4
Maximum no. of parameters = 104328, total number of samples = 4096
Using minSR = True
Running optimization...
Symmetry stage 0/3 on process 0:
Compiling...
  0%|          | 0/1 [00:00<?, ?it/s]2024-12-09 14:52:36.221995: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
  0%|          | 0/1 [00:26<?, ?it/s, Energy=100.29+0.82j ± 0.64 [σ²=1660.12]]100%|██████████| 1/1 [00:00<00:00,  3.56it/s, Energy=100.29+0.82j ± 0.64 [σ²=1660.12]]100%|██████████| 1/1 [00:00<00:00,  3.55it/s, Energy=100.29+0.82j ± 0.64 [σ²=1660.12]]
Compilation time = 27s
Running optimization...
restoring checkpoint #2500
  0%|          | 0/2500 [00:00<?, ?it/s]  0%|          | 0/2500 [00:00<?, ?it/s, Energy=-177.984+0.008j ± 0.065 [σ²=17.120]]100%|█████████▉| 2499/2500 [00:00<00:00, 3958.30it/s, Energy=-177.984+0.008j ± 0.065 [σ²=17.120]]2024-12-09 14:52:54.551040: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
100%|█████████▉| 2499/2500 [00:13<00:00, 3958.30it/s, Energy=-177.984+0.008j ± 0.065 [σ²=17.120]]100%|██████████| 2500/2500 [00:00<00:00, 3869.24it/s, Energy=-177.984+0.008j ± 0.065 [σ²=17.120]]
Optimization time = 13s
Symmetry stage 1/3 on process 0:
Compiling...
  0%|          | 0/1 [00:00<?, ?it/s]2024-12-09 14:53:23.911415: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
  0%|          | 0/1 [00:24<?, ?it/s, Energy=-178.85-0.62j ± 0.51 [σ²=1080.53]]100%|██████████| 1/1 [00:00<00:00,  3.36it/s, Energy=-178.85-0.62j ± 0.51 [σ²=1080.53]]100%|██████████| 1/1 [00:00<00:00,  3.35it/s, Energy=-178.85-0.62j ± 0.51 [σ²=1080.53]]
Compilation time = 24s
Running optimization...
restoring checkpoint #2500
  0%|          | 0/2500 [00:00<?, ?it/s]  0%|          | 0/2500 [00:00<?, ?it/s, Energy=-179.078-0.001j ± 0.044 [σ²=7.768]]100%|█████████▉| 2499/2500 [00:00<00:00, 4070.55it/s, Energy=-179.078-0.001j ± 0.044 [σ²=7.768]]2024-12-09 14:53:43.099177: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
100%|█████████▉| 2499/2500 [00:19<00:00, 4070.55it/s, Energy=-179.078-0.001j ± 0.044 [σ²=7.768]]100%|█████████▉| 2499/2500 [00:19<00:00, 4070.55it/s, Energy=-179.078-0.001j ± 0.044 [σ²=7.768]]100%|██████████| 2500/2500 [00:00<00:00, 3962.45it/s, Energy=-179.078-0.001j ± 0.044 [σ²=7.768]]
Optimization time = 20s
Symmetry stage 2/3 on process 0:
Compiling...
  0%|          | 0/1 [00:00<?, ?it/s]2024-12-09 14:54:19.211648: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
  0%|          | 0/1 [00:28<?, ?it/s, Energy=-178.98-0.19j ± 0.19 [σ²=152.16]]100%|██████████| 1/1 [00:00<00:00,  3.13it/s, Energy=-178.98-0.19j ± 0.19 [σ²=152.16]]100%|██████████| 1/1 [00:00<00:00,  3.13it/s, Energy=-178.98-0.19j ± 0.19 [σ²=152.16]]
Compilation time = 29s
Running optimization...
restoring checkpoint #2500
  0%|          | 0/2500 [00:00<?, ?it/s]  0%|          | 0/2500 [00:00<?, ?it/s, Energy=-179.436+0.006j ± 0.037 [σ²=5.515]]100%|█████████▉| 2499/2500 [00:00<00:00, 3685.47it/s, Energy=-179.436+0.006j ± 0.037 [σ²=5.515]]100%|█████████▉| 2499/2500 [00:13<00:00, 3685.47it/s, Energy=-179.436+0.006j ± 0.037 [σ²=5.515]]2024-12-09 14:54:42.820184: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
100%|█████████▉| 2499/2500 [00:24<00:00, 3685.47it/s, Energy=-179.436+0.006j ± 0.037 [σ²=5.515]]100%|██████████| 2500/2500 [00:00<00:00, 3588.73it/s, Energy=-179.436+0.006j ± 0.037 [σ²=5.515]]
Optimization time = 25s
Symmetry stage 3/3 on process 0:
Compiling...
  0%|          | 0/1 [00:00<?, ?it/s]2024-12-09 14:55:33.302254: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
  0%|          | 0/1 [00:47<?, ?it/s, Energy=-179.05+0.11j ± 0.12 [σ²=59.20]]100%|██████████| 1/1 [00:00<00:00,  3.29it/s, Energy=-179.05+0.11j ± 0.12 [σ²=59.20]]100%|██████████| 1/1 [00:00<00:00,  3.29it/s, Energy=-179.05+0.11j ± 0.12 [σ²=59.20]]
Compilation time = 48s
Running optimization...
  0%|          | 0/2500 [00:00<?, ?it/s]2024-12-09 14:56:10.443287: W external/xla/xla/hlo/transforms/simplifiers/hlo_rematerialization.cc:3020] Can't reduce memory use below 56.38GiB (60540585278 bytes) by rematerialization; only reduced to 58.33GiB (62637641460 bytes), down from 63.31GiB (67975466292 bytes) originally
2024-12-09 14:56:13.542904: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
2024-12-09 14:56:35.104676: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_3_bfc) ran out of memory trying to allocate 2.01GiB (rounded to 2156070656)requested by op 
2024-12-09 14:56:35.104766: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_2_bfc) ran out of memory trying to allocate 2.01GiB (rounded to 2156070656)requested by op 
2024-12-09 14:56:35.104837: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_0_bfc) ran out of memory trying to allocate 2.01GiB (rounded to 2156070656)requested by op 
2024-12-09 14:56:35.104901: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_5_bfc) ran out of memory trying to allocate 2.01GiB (rounded to 2156070656)requested by op 
2024-12-09 14:56:35.105004: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_7_bfc) ran out of memory trying to allocate 2.01GiB (rounded to 2156070656)requested by op 
2024-12-09 14:56:35.105086: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_1_bfc) ran out of memory trying to allocate 2.01GiB (rounded to 2156070656)requested by op 
2024-12-09 14:56:35.105191: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_6_bfc) ran out of memory trying to allocate 2.01GiB (rounded to 2156070656)requested by op 
2024-12-09 14:56:35.105264: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
2024-12-09 14:56:35.105310: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_4_bfc) ran out of memory trying to allocate 2.01GiB (rounded to 2156070656)requested by op 
2024-12-09 14:56:35.105395: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
2024-12-09 14:56:35.105420: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
E1209 14:56:35.105450 1085068 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Unable to allocate device workspace for syevd
2024-12-09 14:56:35.105456: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
2024-12-09 14:56:35.105545: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
2024-12-09 14:56:35.105594: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
2024-12-09 14:56:35.105659: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
2024-12-09 14:56:35.105824: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
E1209 14:56:35.105967 1085071 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Unable to allocate device workspace for syevd
E1209 14:56:35.105997 1085062 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Unable to allocate device workspace for syevd
E1209 14:56:35.106107 1085065 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Unable to allocate device workspace for syevd
E1209 14:56:35.106178 1085074 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Unable to allocate device workspace for syevd
E1209 14:56:35.106223 1085077 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Unable to allocate device workspace for syevd
E1209 14:56:35.106243 1085080 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Unable to allocate device workspace for syevd
E1209 14:56:35.106258 1085083 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Unable to allocate device workspace for syevd
  0%|          | 0/2500 [00:48<?, ?it/s]
Out of memory, reducing chunk_size to 256 and retrying
Compiling...
  0%|          | 0/1 [00:00<?, ?it/s]2024-12-09 14:56:45.742028: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_0_bfc) ran out of memory trying to allocate 6.70GiB (rounded to 7191145216)requested by op 
2024-12-09 14:56:45.742101: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_7_bfc) ran out of memory trying to allocate 6.70GiB (rounded to 7191145216)requested by op 
2024-12-09 14:56:45.742241: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_4_bfc) ran out of memory trying to allocate 6.70GiB (rounded to 7191145216)requested by op 
2024-12-09 14:56:45.742313: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_1_bfc) ran out of memory trying to allocate 6.70GiB (rounded to 7191145216)requested by op 
2024-12-09 14:56:45.742400: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_6_bfc) ran out of memory trying to allocate 6.70GiB (rounded to 7191145216)requested by op 
2024-12-09 14:56:45.742473: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
2024-12-09 14:56:45.742508: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_3_bfc) ran out of memory trying to allocate 6.70GiB (rounded to 7191145216)requested by op 
E1209 14:56:45.742526 1085062 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 7191145000 bytes.
2024-12-09 14:56:45.742577: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_2_bfc) ran out of memory trying to allocate 6.70GiB (rounded to 7191145216)requested by op 
2024-12-09 14:56:45.742629: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
2024-12-09 14:56:45.742672: W external/xla/xla/tsl/framework/bfc_allocator.cc:497] Allocator (GPU_5_bfc) ran out of memory trying to allocate 6.70GiB (rounded to 7191145216)requested by op 
E1209 14:56:45.742689 1085083 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 7191145000 bytes.
2024-12-09 14:56:45.742766: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
2024-12-09 14:56:45.742790: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
2024-12-09 14:56:45.742800: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
E1209 14:56:45.742798 1085074 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 7191145000 bytes.
E1209 14:56:45.742817 1085080 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 7191145000 bytes.
2024-12-09 14:56:45.742834: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
2024-12-09 14:56:45.742853: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
E1209 14:56:45.742878 1085068 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 7191145000 bytes.
E1209 14:56:45.742863 1085071 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 7191145000 bytes.
E1209 14:56:45.742857 1085065 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 7191145000 bytes.
2024-12-09 14:56:45.743116: W external/xla/xla/tsl/framework/bfc_allocator.cc:508] ****************************************************************************************************
E1209 14:56:45.743173 1085077 pjrt_stream_executor_client.cc:3086] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 7191145000 bytes.
  0%|          | 0/1 [00:10<?, ?it/s]
Traceback (most recent call last):
  File "/lustre/fswork/projects/rech/rgs/uvm91ap/repos/netket_pro_update/deepnets/scripts/../optimization/run.py", line 68, in <module>
    sim_time, n_parameters = protocol.run()
                             ^^^^^^^^^^^^^^
  File "/lustre/fswork/projects/rech/rgs/uvm91ap/repos/netket_pro_update/deepnets/optimization/protocols.py", line 563, in run
    sim_time, final_lr, final_diag_shift = self.optimize()
                                           ^^^^^^^^^^^^^^^
  File "/lustre/fswork/projects/rech/rgs/uvm91ap/repos/netket_pro_update/deepnets/optimization/protocols.py", line 484, in optimize
    driver.run(
  File "/lustre/fsn1/projects/rech/rgs/uvm91ap/uv_envs/nk_pro_update/.venv/lib/python3.12/site-packages/netket/driver/abstract_variational_driver.py", line 347, in run
    for step in self.iter(n_iter, step_size):
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/lustre/fswork/projects/rech/rgs/uvm91ap/repos/netket_pro_update/packages/netket_checkpoint/_src/driver1/abstract_variational_driver.py", line 70, in iter
    dp = self._forward_and_backward()
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/lustre/fswork/projects/rech/rgs/uvm91ap/repos/netket_pro_update/packages/netket_pro/_src/driver/vmc_srt_ntk.py", line 376, in _forward_and_backward
    local_energies = self.state.local_estimators(self._ham)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/lustre/fsn1/projects/rech/rgs/uvm91ap/uv_envs/nk_pro_update/.venv/lib/python3.12/site-packages/netket/utils/timing.py", line 276, in timed_function
    result = fun(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^
  File "/lustre/fsn1/projects/rech/rgs/uvm91ap/uv_envs/nk_pro_update/.venv/lib/python3.12/site-packages/netket/vqs/mc/mc_state/state.py", line 614, in local_estimators
    return local_estimators(self, op, chunk_size=chunk_size)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/lustre/fsn1/projects/rech/rgs/uvm91ap/uv_envs/nk_pro_update/.venv/lib/python3.12/site-packages/netket/vqs/mc/mc_state/state.py", line 782, in local_estimators
    s, extra_args = get_local_kernel_arguments(state, op)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/lustre/fsn1/projects/rech/rgs/uvm91ap/uv_envs/nk_pro_update/.venv/lib/python3.12/site-packages/plum/function.py", line 383, in __call__
    return _convert(method(*args, **kw_args), return_type)
                    ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/lustre/fsn1/projects/rech/rgs/uvm91ap/uv_envs/nk_pro_update/.venv/lib/python3.12/site-packages/netket/vqs/mc/mc_state/expect.py", line 75, in get_local_kernel_arguments
    σ = vstate.samples
        ^^^^^^^^^^^^^^
  File "/lustre/fswork/projects/rech/rgs/uvm91ap/repos/netket_pro_update/packages/netket_pro/_src/monkeypatch/mcstate_sampling.py", line 341, in samples
    return self.samples_distribution()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/lustre/fswork/projects/rech/rgs/uvm91ap/repos/netket_pro_update/packages/netket_pro/_src/monkeypatch/mcstate_sampling.py", line 274, in samples_distribution
    self.sample_distribution(
  File "/lustre/fswork/projects/rech/rgs/uvm91ap/repos/netket_pro_update/packages/netket_pro/_src/monkeypatch/mcstate_sampling.py", line 199, in sample_distribution
    sampler_state = self.sampler.reset(distribution, variables, sampler_state)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/lustre/fsn1/projects/rech/rgs/uvm91ap/uv_envs/nk_pro_update/.venv/lib/python3.12/site-packages/netket/sampler/base.py", line 265, in reset
    return sampler._reset(wrap_afun(machine), parameters, state)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 7191145000 bytes.: while running replica 0 and partition 0 of a replicated computation (other replicas may have failed as well).
srun: error: jean-zay-iam48: task 0: Exited with exit code 1
srun: Terminating StepId=1232291.0
