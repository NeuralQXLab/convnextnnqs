Job running on nodes: jean-zay-iam46
Resolved 61 packages in 21ms
Configuring sharding...
Number of distributed processes = 1
Number of total devices: 8
0/1 : global [CudaDevice(id=0), CudaDevice(id=1), CudaDevice(id=2), CudaDevice(id=3), CudaDevice(id=4), CudaDevice(id=5), CudaDevice(id=6), CudaDevice(id=7)]
0/1 : local [CudaDevice(id=0), CudaDevice(id=1), CudaDevice(id=2), CudaDevice(id=3), CudaDevice(id=4), CudaDevice(id=5), CudaDevice(id=6), CudaDevice(id=7)]
0/1 : hostname:  jean-zay-iam46
args_setup: Namespace(config='/lustre/fswork/projects/rech/rgs/uvm91ap/projects/deepNQS/ConvNext/30_01_25/J1J2_L10_benchmark_run/2/config.yaml', system='Square_Heisenberg', network='ConvNext')
args: Namespace(config=None, system=None, network=None, L=10, J=[1.0, 0.5], sign_rule=[0, 0], patching=1, n_blocks=[6], features=[72], expansion_factor=3, net_type='Vanilla', kernel_width=3, downsample_factor=2, final_features=144, init_kernel_width=1, output_depth=2, samples_per_rank=512, n_chains_per_rank=512, discard_fraction=0.0, iters=[2500, 2500, 1000, 200, 100], lr=[0.01, 0.01, 0.01, 0.01, 0.01], diag_shift=[0.01, 0.01, 0.01, 0.01, 0.01], diag_shift_factor=[0.0001, 0.0001, 0.0001, 0.0001, 0.0001], r=1e-06, save_base='', save_num=0, seed=8138, time_it=0, show_progress=1, chunk_size=128, lr_factor=[0.5, 0.5, 0.5, 0.5, 0.5], save_every=100, symmetries=0, symmetry_ramping=1, momentum=0.9, checkpoint=1, post_iters=50, sweep_factor=4, double_precision=1)
Double precision enabled =  True
Using net_type=Vanilla
Number of symmetry stages = 5
Maximum no. of parameters = 260568, total number of samples = 4096
Using minSR = True
Running optimization...
Symmetry stage 0/4 on process 0:
Compiling...
  0%|          | 0/1 [00:00<?, ?it/s]2025-02-14 06:07:13.770365: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
  0%|          | 0/1 [00:39<?, ?it/s, Energy=33.59-0.65j ± 0.66 [σ²=1762.08]]100%|██████████| 1/1 [00:00<00:00,  2.59it/s, Energy=33.59-0.65j ± 0.66 [σ²=1762.08]]100%|██████████| 1/1 [00:00<00:00,  2.59it/s, Energy=33.59-0.65j ± 0.66 [σ²=1762.08]]
Compilation time = 40s
Running optimization...
restoring checkpoint #2500
  0%|          | 0/2500 [00:00<?, ?it/s]  0%|          | 0/2500 [00:01<?, ?it/s, Energy=-198.672+0.000j ± 0.040 [σ²=6.637]]100%|█████████▉| 2499/2500 [00:01<00:00, 1468.08it/s, Energy=-198.672+0.000j ± 0.040 [σ²=6.637]]2025-02-14 06:07:49.368881: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
100%|█████████▉| 2499/2500 [00:20<00:00, 1468.08it/s, Energy=-198.672+0.000j ± 0.040 [σ²=6.637]]100%|█████████▉| 2499/2500 [00:28<00:00, 1468.08it/s, Energy=-198.672+0.000j ± 0.040 [σ²=6.637]]100%|██████████| 2500/2500 [00:01<00:00, 1447.03it/s, Energy=-198.672+0.000j ± 0.040 [σ²=6.637]]
Optimization time = 29s
Symmetry stage 1/4 on process 0:
Compiling...
  0%|          | 0/1 [00:00<?, ?it/s]2025-02-14 06:08:48.543247: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
  0%|          | 0/1 [00:53<?, ?it/s, Energy=-198.826+0.003j ± 0.036 [σ²=5.409]]100%|██████████| 1/1 [00:00<00:00,  2.39it/s, Energy=-198.826+0.003j ± 0.036 [σ²=5.409]]100%|██████████| 1/1 [00:00<00:00,  2.39it/s, Energy=-198.826+0.003j ± 0.036 [σ²=5.409]]
Compilation time = 54s
Running optimization...
restoring checkpoint #2500
  0%|          | 0/2500 [00:00<?, ?it/s]  0%|          | 0/2500 [00:01<?, ?it/s, Energy=-198.937-0.002j ± 0.027 [σ²=2.906]]100%|█████████▉| 2499/2500 [00:01<00:00, 1587.90it/s, Energy=-198.937-0.002j ± 0.027 [σ²=2.906]]100%|█████████▉| 2499/2500 [00:18<00:00, 1587.90it/s, Energy=-198.937-0.002j ± 0.027 [σ²=2.906]]2025-02-14 06:09:41.262927: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
100%|█████████▉| 2499/2500 [00:52<00:00, 1587.90it/s, Energy=-198.937-0.002j ± 0.027 [σ²=2.906]]100%|██████████| 2500/2500 [00:01<00:00, 1563.48it/s, Energy=-198.937-0.002j ± 0.027 [σ²=2.906]]
Optimization time = 53s
Symmetry stage 2/4 on process 0:
Compiling...
  0%|          | 0/1 [00:00<?, ?it/s]2025-02-14 06:11:49.637834: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
  0%|          | 0/1 [02:05<?, ?it/s, Energy=-198.957+0.003j ± 0.021 [σ²=1.755]]100%|██████████| 1/1 [00:00<00:00,  2.21it/s, Energy=-198.957+0.003j ± 0.021 [σ²=1.755]]100%|██████████| 1/1 [00:00<00:00,  2.20it/s, Energy=-198.957+0.003j ± 0.021 [σ²=1.755]]
Compilation time = 126s
Running optimization...
restoring checkpoint #1000
  0%|          | 0/1000 [00:00<?, ?it/s]  0%|          | 0/1000 [00:01<?, ?it/s, Energy=-198.987-0.001j ± 0.016 [σ²=1.107]]100%|█████████▉| 999/1000 [00:01<00:00, 668.95it/s, Energy=-198.987-0.001j ± 0.016 [σ²=1.107]]100%|█████████▉| 999/1000 [00:20<00:00, 668.95it/s, Energy=-198.987-0.001j ± 0.016 [σ²=1.107]]2025-02-14 06:13:53.851172: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
100%|█████████▉| 999/1000 [02:05<00:00, 668.95it/s, Energy=-198.987-0.001j ± 0.016 [σ²=1.107]]100%|██████████| 1000/1000 [00:01<00:00, 658.28it/s, Energy=-198.987-0.001j ± 0.016 [σ²=1.107]]
Optimization time = 125s
Symmetry stage 3/4 on process 0:
Compiling...
  0%|          | 0/1 [00:00<?, ?it/s]2025-02-14 06:17:29.167123: E external/xla/xla/service/slow_operation_alarm.cc:73] Trying algorithm eng20{k2=6,k3=0} for conv %cudnn-conv-bw-filter.30 = (f64[72,1,3,3]{3,2,1,0}, u8[0]{0}) custom-call(f64[4096,72,7,7]{3,2,1,0} %bitcast.54803, f64[4096,72,5,5]{3,2,1,0} %bitcast.55800), window={size=3x3}, dim_labels=bf01_oi01->bf01, feature_group_count=72, custom_call_target="__cudnn$convBackwardFilter", metadata={op_name="jit(SRt_ntk)/jit(main)/jit(shmap_body)/while/body/transpose(jvp(SymmExpSum))/module/encoder/stages_0/layers_0/Conv_0/conv_general_dilated" source_file="/lustre/fsn1/projects/rech/rgs/uvm91ap/uv_envs/nk_pro_update/.venv/lib/python3.12/site-packages/flax/linen/linear.py" source_line=658}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"cudnn_conv_backend_config":{"conv_result_scale":1,"activation_mode":"kNone","side_input_scale":0,"leakyrelu_alpha":0},"force_earliest_schedule":false} is taking a while...
2025-02-14 06:17:29.937846: E external/xla/xla/service/slow_operation_alarm.cc:140] The operation took 1.770828856s
Trying algorithm eng20{k2=6,k3=0} for conv %cudnn-conv-bw-filter.30 = (f64[72,1,3,3]{3,2,1,0}, u8[0]{0}) custom-call(f64[4096,72,7,7]{3,2,1,0} %bitcast.54803, f64[4096,72,5,5]{3,2,1,0} %bitcast.55800), window={size=3x3}, dim_labels=bf01_oi01->bf01, feature_group_count=72, custom_call_target="__cudnn$convBackwardFilter", metadata={op_name="jit(SRt_ntk)/jit(main)/jit(shmap_body)/while/body/transpose(jvp(SymmExpSum))/module/encoder/stages_0/layers_0/Conv_0/conv_general_dilated" source_file="/lustre/fsn1/projects/rech/rgs/uvm91ap/uv_envs/nk_pro_update/.venv/lib/python3.12/site-packages/flax/linen/linear.py" source_line=658}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"cudnn_conv_backend_config":{"conv_result_scale":1,"activation_mode":"kNone","side_input_scale":0,"leakyrelu_alpha":0},"force_earliest_schedule":false} is taking a while...
2025-02-14 06:17:34.194277: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
  0%|          | 0/1 [03:36<?, ?it/s, Energy=-198.988+0.000j ± 0.016 [σ²=1.112]]100%|██████████| 1/1 [00:00<00:00,  2.11it/s, Energy=-198.988+0.000j ± 0.016 [σ²=1.112]]100%|██████████| 1/1 [00:00<00:00,  2.11it/s, Energy=-198.988+0.000j ± 0.016 [σ²=1.112]]
Compilation time = 217s
Running optimization...
restoring checkpoint #200
  0%|          | 0/200 [00:00<?, ?it/s]  0%|          | 0/200 [00:01<?, ?it/s, Energy=-199.021+0.000j ± 0.013 [σ²=0.739]]100%|█████████▉| 199/200 [00:01<00:00, 127.65it/s, Energy=-199.021+0.000j ± 0.013 [σ²=0.739]]100%|█████████▉| 199/200 [00:19<00:00, 127.65it/s, Energy=-199.021+0.000j ± 0.013 [σ²=0.739]]2025-02-14 06:21:09.165098: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
100%|█████████▉| 199/200 [03:35<00:00, 127.65it/s, Energy=-199.021+0.000j ± 0.013 [σ²=0.739]]100%|██████████| 200/200 [00:01<00:00, 125.63it/s, Energy=-199.021+0.000j ± 0.013 [σ²=0.739]]
Optimization time = 216s
Symmetry stage 4/4 on process 0:
Compiling...
  0%|          | 0/1 [00:00<?, ?it/s]2025-02-14 06:28:00.500975: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
  0%|          | 0/1 [07:00<?, ?it/s, Energy=-199.054+0.003j ± 0.024 [σ²=2.347]]100%|██████████| 1/1 [00:00<00:00,  2.34it/s, Energy=-199.054+0.003j ± 0.024 [σ²=2.347]]100%|██████████| 1/1 [00:00<00:00,  2.33it/s, Energy=-199.054+0.003j ± 0.024 [σ²=2.347]]
Compilation time = 421s
Running optimization...
restoring checkpoint #100
  0%|          | 0/100 [00:00<?, ?it/s]  0%|          | 0/100 [00:01<?, ?it/s, Energy=-199.038-0.000j ± 0.017 [σ²=1.218]] 99%|█████████▉| 99/100 [00:01<00:00, 96.79it/s, Energy=-199.038-0.000j ± 0.017 [σ²=1.218]] 99%|█████████▉| 99/100 [00:13<00:00, 96.79it/s, Energy=-199.038-0.000j ± 0.017 [σ²=1.218]]2025-02-14 06:35:01.555154: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
 99%|█████████▉| 99/100 [07:02<00:00, 96.79it/s, Energy=-199.038-0.000j ± 0.017 [σ²=1.218]]100%|██████████| 100/100 [00:01<00:00, 95.10it/s, Energy=-199.038-0.000j ± 0.017 [σ²=1.218]]
Optimization time = 422s
Finished optimization
Performing 50 additional optimization steps...
Sampling parameters:
n_chains = 256
n_samples = 4096
n_discard_per_chain = 128
restoring checkpoint #40
  0%|          | 0/50 [00:00<?, ?it/s]2025-02-14 06:48:52.753473: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
  0%|          | 0/50 [13:45<?, ?it/s, Energy=-199.030-0.000j ± 0.016 [σ²=0.920, R̂=1.0345]] 80%|████████  | 40/50 [13:45<03:26, 20.63s/it, Energy=-199.030-0.000j ± 0.016 [σ²=0.920, R̂=1.0345]]2025-02-14 07:02:27.014163: W external/xla/xla/service/gpu/ir_emitter_unnested.cc:1171] Unable to parse backend config for custom call: Could not convert JSON string to proto: Expected : between key:value pair.
= 0 : ui8, lower = t
^
Fall back to parse the raw backend config str.
 80%|████████  | 40/50 [27:21<03:26, 20.63s/it, Energy=-199.030-0.000j ± 0.016 [σ²=0.920, R̂=1.0345]] 80%|████████  | 40/50 [26:41<03:26, 20.63s/it, Energy=-199.072-0.002j ± 0.017 [σ²=1.046, R̂=1.0300]] 82%|████████▏ | 41/50 [26:41<07:00, 46.69s/it, Energy=-199.072-0.002j ± 0.017 [σ²=1.046, R̂=1.0300]]WARNING:absl:[process=0][thread=async_save] Skipping merge of OCDBT checkpoints: No per-process OCDBT checkpoint subdirs found in /lustre/fswork/projects/rech/rgs/uvm91ap/projects/deepNQS/ConvNext/30_01_25/J1J2_L10_benchmark_run/2/post/checkpoint/41.orbax-checkpoint-tmp-0/loggers.orbax-checkpoint-tmp-3, 
 82%|████████▏ | 41/50 [39:37<07:00, 46.69s/it, Energy=-199.046+0.001j ± 0.014 [σ²=0.749, R̂=1.0315]] 84%|████████▍ | 42/50 [39:37<10:47, 80.93s/it, Energy=-199.046+0.001j ± 0.014 [σ²=0.749, R̂=1.0315]]WARNING:absl:[process=0][thread=async_save] Skipping merge of OCDBT checkpoints: No per-process OCDBT checkpoint subdirs found in /lustre/fswork/projects/rech/rgs/uvm91ap/projects/deepNQS/ConvNext/30_01_25/J1J2_L10_benchmark_run/2/post/checkpoint/42.orbax-checkpoint-tmp-5/loggers.orbax-checkpoint-tmp-8, 
 84%|████████▍ | 42/50 [52:33<10:47, 80.93s/it, Energy=-199.024-0.003j ± 0.016 [σ²=1.150, R̂=1.0301]] 86%|████████▌ | 43/50 [52:33<14:32, 124.61s/it, Energy=-199.024-0.003j ± 0.016 [σ²=1.150, R̂=1.0301]]WARNING:absl:[process=0][thread=async_save] Skipping merge of OCDBT checkpoints: No per-process OCDBT checkpoint subdirs found in /lustre/fswork/projects/rech/rgs/uvm91ap/projects/deepNQS/ConvNext/30_01_25/J1J2_L10_benchmark_run/2/post/checkpoint/43.orbax-checkpoint-tmp-10/loggers.orbax-checkpoint-tmp-13, 
 86%|████████▌ | 43/50 [1:05:29<14:32, 124.61s/it, Energy=-199.020+0.002j ± 0.015 [σ²=0.907, R̂=1.0304]] 88%|████████▊ | 44/50 [1:05:29<17:49, 178.27s/it, Energy=-199.020+0.002j ± 0.015 [σ²=0.907, R̂=1.0304]]WARNING:absl:[process=0][thread=async_save] Skipping merge of OCDBT checkpoints: No per-process OCDBT checkpoint subdirs found in /lustre/fswork/projects/rech/rgs/uvm91ap/projects/deepNQS/ConvNext/30_01_25/J1J2_L10_benchmark_run/2/post/checkpoint/44.orbax-checkpoint-tmp-15/loggers.orbax-checkpoint-tmp-18, 
 88%|████████▊ | 44/50 [1:18:25<17:49, 178.27s/it, Energy=-199.038+0.001j ± 0.014 [σ²=0.940, R̂=1.0296]] 90%|█████████ | 45/50 [1:18:25<20:05, 241.19s/it, Energy=-199.038+0.001j ± 0.014 [σ²=0.940, R̂=1.0296]]WARNING:absl:[process=0][thread=async_save] Skipping merge of OCDBT checkpoints: No per-process OCDBT checkpoint subdirs found in /lustre/fswork/projects/rech/rgs/uvm91ap/projects/deepNQS/ConvNext/30_01_25/J1J2_L10_benchmark_run/2/post/checkpoint/45.orbax-checkpoint-tmp-20/loggers.orbax-checkpoint-tmp-23, 
 90%|█████████ | 45/50 [1:31:21<20:05, 241.19s/it, Energy=-199.047-0.001j ± 0.013 [σ²=0.766, R̂=1.0317]] 92%|█████████▏| 46/50 [1:31:21<20:44, 311.12s/it, Energy=-199.047-0.001j ± 0.013 [σ²=0.766, R̂=1.0317]]WARNING:absl:[process=0][thread=async_save] Skipping merge of OCDBT checkpoints: No per-process OCDBT checkpoint subdirs found in /lustre/fswork/projects/rech/rgs/uvm91ap/projects/deepNQS/ConvNext/30_01_25/J1J2_L10_benchmark_run/2/post/checkpoint/46.orbax-checkpoint-tmp-25/loggers.orbax-checkpoint-tmp-28, 
 92%|█████████▏| 46/50 [1:44:16<20:44, 311.12s/it, Energy=-199.021+0.001j ± 0.018 [σ²=1.301, R̂=1.0283]] 94%|█████████▍| 47/50 [1:44:16<19:12, 384.29s/it, Energy=-199.021+0.001j ± 0.018 [σ²=1.301, R̂=1.0283]]WARNING:absl:[process=0][thread=async_save] Skipping merge of OCDBT checkpoints: No per-process OCDBT checkpoint subdirs found in /lustre/fswork/projects/rech/rgs/uvm91ap/projects/deepNQS/ConvNext/30_01_25/J1J2_L10_benchmark_run/2/post/checkpoint/47.orbax-checkpoint-tmp-30/loggers.orbax-checkpoint-tmp-33, 
 94%|█████████▍| 47/50 [1:57:12<19:12, 384.29s/it, Energy=-199.039+0.002j ± 0.014 [σ²=0.781, R̂=1.0315]] 96%|█████████▌| 48/50 [1:57:12<15:12, 456.20s/it, Energy=-199.039+0.002j ± 0.014 [σ²=0.781, R̂=1.0315]]WARNING:absl:[process=0][thread=async_save] Skipping merge of OCDBT checkpoints: No per-process OCDBT checkpoint subdirs found in /lustre/fswork/projects/rech/rgs/uvm91ap/projects/deepNQS/ConvNext/30_01_25/J1J2_L10_benchmark_run/2/post/checkpoint/48.orbax-checkpoint-tmp-35/loggers.orbax-checkpoint-tmp-38, 
 96%|█████████▌| 48/50 [2:10:09<15:12, 456.20s/it, Energy=-199.031-0.001j ± 0.012 [σ²=0.583, R̂=1.0332]] 98%|█████████▊| 49/50 [2:10:09<08:42, 522.66s/it, Energy=-199.031-0.001j ± 0.012 [σ²=0.583, R̂=1.0332]]WARNING:absl:[process=0][thread=async_save] Skipping merge of OCDBT checkpoints: No per-process OCDBT checkpoint subdirs found in /lustre/fswork/projects/rech/rgs/uvm91ap/projects/deepNQS/ConvNext/30_01_25/J1J2_L10_benchmark_run/2/post/checkpoint/49.orbax-checkpoint-tmp-40/loggers.orbax-checkpoint-tmp-43, 
WARNING:absl:[process=0][thread=async_save] Skipping merge of OCDBT checkpoints: No per-process OCDBT checkpoint subdirs found in /lustre/fswork/projects/rech/rgs/uvm91ap/projects/deepNQS/ConvNext/30_01_25/J1J2_L10_benchmark_run/2/post/checkpoint/50.orbax-checkpoint-tmp-45/loggers.orbax-checkpoint-tmp-48, 
100%|██████████| 50/50 [2:10:10<00:00, 156.20s/it, Energy=-199.031-0.001j ± 0.012 [σ²=0.583, R̂=1.0332]]
Final 50 energies = [-199.02933589 -198.9941081  -199.00727817 -199.04427904 -199.03595957
 -199.03665812 -199.00732409 -199.00234654 -199.01504426 -199.02682762
 -199.05366626 -199.01392427 -199.01422175 -199.00977457 -199.02089691
 -199.04303308 -199.00847978 -199.02694939 -199.01828239 -199.06348514
 -199.02441818 -199.03103702 -199.02677759 -199.0153705  -199.03058447
 -199.03276828 -199.01723951 -199.00610357 -199.07266822 -199.02399948
 -199.04387206 -199.03007676 -199.0403845  -199.03253204 -199.02866082
 -199.00548049 -199.00047182 -199.05042872 -199.04040299 -199.03122133
 -199.03018795 -199.0716392  -199.0460756  -199.02360435 -199.02008227
 -199.03803208 -199.0471814  -199.02113056 -199.03891433 -199.03110026]
min_index=28
Finished additional optimization steps
Post-processing time = 8630s
Saving simulation results to opt.log
Finished on process 0
